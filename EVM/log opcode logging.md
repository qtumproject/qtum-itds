# Log opcode logging

Using the EVM LOG opcode is extremely useful for debugging and developing contracts, as well as developing Qtum itself. So, we should expose this info clearly and easily to developers that are interested 

## Environment

qtumd started with -record-log-opcodes, any network mode is ok. 

## Test Steps

1. Compile attached contract code
2. Deploy to blockchain
3. Call `CallTest` function using OP_CALL
4. Call `MakeLogs` function using off-chain execution

## Expected Results

Steps 2, 3, and 4 should result in identical logs being created: (in off-chain execution, block hash should be 0)

(in JSON)

    {
        "logs": [
            {
                "txid": "[txid of deployment tx]"
                "address": "[address of contract]",
                "time": "[timestamp of block it was mined in]",
                "blockhash": "[hash of block it was mined in]",
                "blockheight": "[height of block it was mined in]",
                "entries": [
                    {
                        "data": {"raw": "3000000000000000000000000000000000000000000000000000000000000000", "pretty": "0"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000000000", "pretty": 0}
                        ]
                    },
                    {
                        "data": {"raw": "3100000000000000000000000000000000000000000000000000000000000000", "pretty": "1"},
                        topics: [
                            {"raw": "50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20"}
                        ]
                    },
                    {
                        "data": {"raw": "3200000000000000000000000000000000000000000000000000000000000000", "pretty": "2"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000004021", "pretty": 16417}
                        ]
                    },
                    {
                        "data": {"raw": "3300000000000000000000000000000000000000000000000000000000000000", "pretty": "3"},
                        topics: [
                            {"raw": "737472696E672074657374000000000000000000000000000000000000000000", "pretty": "string test"}
                        ]
                    },
                    {
                        "data": {"raw": "3400000000000000000000000000000000000000000000000000000000000000", "pretty": "4"},
                        topics: [
                            {"raw": "3132333435360000000000000000000000000000000000000000000000000000", "pretty": "123456"}
                        ]
                    },
                    {
                        "data": {"raw": "3500000000000000000000000000000000000000000000000000000000000000", "pretty": "5"},
                        topics: [
                            {"raw": "0x746F706963203100000000000000000000000000000000000000000000000000", "pretty": "topic 1"},
                            {"raw": "0x746F706963203200000000000000000000000000000000000000000000000000", "pretty": "topic 2"},
                            {"raw": "0x746F706963203300000000000000000000000000000000000000000000000000", "pretty": "topic 3"},
                            {"raw": "0x746F706963203400000000000000000000000000000000000000000000000000", "pretty": "topic 4"}
                        ]
                    },
                    {
                        "data": {"raw": "3600000000000000000000000000000000000000000000000000000000000000", "pretty": "6"},
                        topics: [
                            {"raw": "4142430000000000000000000000000000000000000000000000000000004021", "pretty": "ABC"}
                        ]
                    },
                    {
                        "data": {"raw": "3700000000000000000000000000000000000000000000000000000000000000", "pretty": "7"},
                        topics: [
                            {"raw": "4142050000000000000000000000000000000000000000000000000000004021"}
                        ]
                    },
                    {
                        "data": {"raw": "4142430000000000000000000000000000000000000000000000000000000000", "pretty": "ABC"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    },
                    {
                        "data": {"raw": "4142050000000000000000000000000000000000000000000000000000000000"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    }
                ]
            },
            {
                "txid": "[txid of calling transaction]"
                "address": "[address of contract]",
                "time": "[timestamp of block it was mined in]",
                "blockhash": "[block hash it was mined in]",
                "blockheight": "[block height it was mined in]",
                "entries": [
                    {
                        "data": {"raw": "3000000000000000000000000000000000000000000000000000000000000000", "pretty": "0"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000000000", "pretty": 0}
                        ]
                    },
                    {
                        "data": {"raw": "3100000000000000000000000000000000000000000000000000000000000000", "pretty": "1"},
                        topics: [
                            {"raw": "50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20"}
                        ]
                    },
                    {
                        "data": {"raw": "3200000000000000000000000000000000000000000000000000000000000000", "pretty": "2"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000004021", "pretty": 16417}
                        ]
                    },
                    {
                        "data": {"raw": "3300000000000000000000000000000000000000000000000000000000000000", "pretty": "3"},
                        topics: [
                            {"raw": "737472696E672074657374000000000000000000000000000000000000000000", "pretty": "string test"}
                        ]
                    },
                    {
                        "data": {"raw": "3400000000000000000000000000000000000000000000000000000000000000", "pretty": "4"},
                        topics: [
                            {"raw": "3132333435360000000000000000000000000000000000000000000000000000", "pretty": "123456"}
                        ]
                    },
                    {
                        "data": {"raw": "3500000000000000000000000000000000000000000000000000000000000000", "pretty": "5"},
                        topics: [
                            {"raw": "0x746F706963203100000000000000000000000000000000000000000000000000", "pretty": "topic 1"},
                            {"raw": "0x746F706963203200000000000000000000000000000000000000000000000000", "pretty": "topic 2"},
                            {"raw": "0x746F706963203300000000000000000000000000000000000000000000000000", "pretty": "topic 3"},
                            {"raw": "0x746F706963203400000000000000000000000000000000000000000000000000", "pretty": "topic 4"}
                        ]
                    },
                    {
                        "data": {"raw": "3600000000000000000000000000000000000000000000000000000000000000", "pretty": "6"},
                        topics: [
                            {"raw": "4142430000000000000000000000000000000000000000000000000000004021", "pretty": "ABC"}
                        ]
                    },
                    {
                        "data": {"raw": "3700000000000000000000000000000000000000000000000000000000000000", "pretty": "7"},
                        topics: [
                            {"raw": "4142050000000000000000000000000000000000000000000000000000004021"}
                        ]
                    },
                    {
                        "data": {"raw": "4142430000000000000000000000000000000000000000000000000000000000", "pretty": "ABC"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    },
                    {
                        "data": {"raw": "4142050000000000000000000000000000000000000000000000000000000000"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    }
                ]
            },
            {
                "address": "[contract address]",
                "time": "[timestamp of now]",
                "blockheight": "[blockheight of current block]",
                "entries": [
                    {
                        "data": {"raw": "3000000000000000000000000000000000000000000000000000000000000000", "pretty": "0"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000000000", "pretty": 0}
                        ]
                    },
                    {
                        "data": {"raw": "3100000000000000000000000000000000000000000000000000000000000000", "pretty": "1"},
                        topics: [
                            {"raw": "50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20"}
                        ]
                    },
                    {
                        "data": {"raw": "3200000000000000000000000000000000000000000000000000000000000000", "pretty": "2"},
                        topics: [
                            {"raw": "0000000000000000000000000000000000000000000000000000000000004021", "pretty": 16417}
                        ]
                    },
                    {
                        "data": {"raw": "3300000000000000000000000000000000000000000000000000000000000000", "pretty": "3"},
                        topics: [
                            {"raw": "737472696E672074657374000000000000000000000000000000000000000000", "pretty": "string test"}
                        ]
                    },
                    {
                        "data": {"raw": "3400000000000000000000000000000000000000000000000000000000000000", "pretty": "4"},
                        topics: [
                            {"raw": "3132333435360000000000000000000000000000000000000000000000000000", "pretty": "123456"}
                        ]
                    },
                    {
                        "data": {"raw": "3500000000000000000000000000000000000000000000000000000000000000", "pretty": "5"},
                        topics: [
                            {"raw": "0x746F706963203100000000000000000000000000000000000000000000000000", "pretty": "topic 1"},
                            {"raw": "0x746F706963203200000000000000000000000000000000000000000000000000", "pretty": "topic 2"},
                            {"raw": "0x746F706963203300000000000000000000000000000000000000000000000000", "pretty": "topic 3"},
                            {"raw": "0x746F706963203400000000000000000000000000000000000000000000000000", "pretty": "topic 4"}
                        ]
                    },
                    {
                        "data": {"raw": "3600000000000000000000000000000000000000000000000000000000000000", "pretty": "6"},
                        topics: [
                            {"raw": "4142430000000000000000000000000000000000000000000000000000004021", "pretty": "ABC"}
                        ]
                    },
                    {
                        "data": {"raw": "3700000000000000000000000000000000000000000000000000000000000000", "pretty": "7"},
                        topics: [
                            {"raw": "4142050000000000000000000000000000000000000000000000000000004021"}
                        ]
                    },
                    {
                        "data": {"raw": "4142430000000000000000000000000000000000000000000000000000000000", "pretty": "ABC"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    },
                    {
                        "data": {"raw": "4142050000000000000000000000000000000000000000000000000000000000"},
                        topics: [
                            {"raw": "0x7465737400000000000000000000000000000000000000000000000000000000", "pretty": "test"}
                        ]
                    }
                ]
            }
        ]
    }


Note that the "pretty" parameter will try to detect small integers and strings to display it in a more friendly manner (and so that apps don't necessarily need to parse everything smartly). If the integer is too big, then it won't display a parameter. Also, if the string detected is not null terminated and using normal ASCII characters, then it will not be used either. 

## Code

    pragma solidity ^0.4.0;

    contract LogTest {
       uint num;
       /// Create a new ballot with $(_numProposals) different proposals.
       function LogTest() {
           CallTest();
       }
       function CallTest() public{
           num++; //not a constant function.. 
           MakeLogs();
       }
       function MakeLogs() constant public{
           //0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2
           //0x0000000000000000000000000000000000000000
            log1("0", 0x0000000000000000000000000000000000000000000000000000000000000000);
            log1("1", 0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20);
            log1("2", 0x0000000000000000000000000000000000000000000000000000000000004021);
            log1("3", "string test");
            log1("4", "123456");
            log4("5", "topic 1", "topic 2", "topic 3", "topic 4");
            log1("6", 0x4142430000000000000000000000000000000000000000000000000000004021);
            log1("7", 0x4142050000000000000000000000000000000000000000000000000000004021);
            log1(0x41424300, "test");
            log1(0x41420500, "test");
       }
       
       function uintToBytes(uint v) constant returns (bytes32 ret) {
           if (v == 0) {
               ret = '0';
           }
           else {
               while (v > 0) {
                   ret = bytes32(uint(ret) / (2 ** 8));
                   ret |= bytes32(((v % 10) + 48) * 2 ** (8 * 31));
                   v /= 10;
               }
           }
           return ret;
       }
    }